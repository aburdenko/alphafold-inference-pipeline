{
  "pipelineSpec": {
    "components": {
      "comp-db-search": {
        "executorLabel": "exec-db-search",
        "inputDefinitions": {
          "artifacts": {
            "input_data": {
              "artifactType": {
                "schemaTitle": "system.Dataset",
                "schemaVersion": "0.0.1"
              }
            }
          },
          "parameters": {
            "boot_disk_size": {
              "type": "INT"
            },
            "database_paths": {
              "type": "STRING"
            },
            "db_tool": {
              "type": "STRING"
            },
            "disk_image": {
              "type": "STRING"
            },
            "machine_type": {
              "type": "STRING"
            },
            "project": {
              "type": "STRING"
            },
            "region": {
              "type": "STRING"
            },
            "runner_image": {
              "type": "STRING"
            }
          }
        },
        "outputDefinitions": {
          "artifacts": {
            "logging": {
              "artifactType": {
                "schemaTitle": "system.Artifact",
                "schemaVersion": "0.0.1"
              }
            },
            "output_data": {
              "artifactType": {
                "schemaTitle": "system.Dataset",
                "schemaVersion": "0.0.1"
              }
            }
          }
        }
      },
      "comp-db-search-2": {
        "executorLabel": "exec-db-search-2",
        "inputDefinitions": {
          "artifacts": {
            "input_data": {
              "artifactType": {
                "schemaTitle": "system.Dataset",
                "schemaVersion": "0.0.1"
              }
            }
          },
          "parameters": {
            "boot_disk_size": {
              "type": "INT"
            },
            "database_paths": {
              "type": "STRING"
            },
            "db_tool": {
              "type": "STRING"
            },
            "disk_image": {
              "type": "STRING"
            },
            "machine_type": {
              "type": "STRING"
            },
            "project": {
              "type": "STRING"
            },
            "region": {
              "type": "STRING"
            },
            "runner_image": {
              "type": "STRING"
            }
          }
        },
        "outputDefinitions": {
          "artifacts": {
            "logging": {
              "artifactType": {
                "schemaTitle": "system.Artifact",
                "schemaVersion": "0.0.1"
              }
            },
            "output_data": {
              "artifactType": {
                "schemaTitle": "system.Dataset",
                "schemaVersion": "0.0.1"
              }
            }
          }
        }
      },
      "comp-db-search-3": {
        "executorLabel": "exec-db-search-3",
        "inputDefinitions": {
          "artifacts": {
            "input_data": {
              "artifactType": {
                "schemaTitle": "system.Dataset",
                "schemaVersion": "0.0.1"
              }
            }
          },
          "parameters": {
            "boot_disk_size": {
              "type": "INT"
            },
            "database_paths": {
              "type": "STRING"
            },
            "db_tool": {
              "type": "STRING"
            },
            "disk_image": {
              "type": "STRING"
            },
            "machine_type": {
              "type": "STRING"
            },
            "project": {
              "type": "STRING"
            },
            "region": {
              "type": "STRING"
            },
            "runner_image": {
              "type": "STRING"
            }
          }
        },
        "outputDefinitions": {
          "artifacts": {
            "logging": {
              "artifactType": {
                "schemaTitle": "system.Artifact",
                "schemaVersion": "0.0.1"
              }
            },
            "output_data": {
              "artifactType": {
                "schemaTitle": "system.Dataset",
                "schemaVersion": "0.0.1"
              }
            }
          }
        }
      },
      "comp-db-search-4": {
        "executorLabel": "exec-db-search-4",
        "inputDefinitions": {
          "artifacts": {
            "input_data": {
              "artifactType": {
                "schemaTitle": "system.Dataset",
                "schemaVersion": "0.0.1"
              }
            }
          },
          "parameters": {
            "boot_disk_size": {
              "type": "INT"
            },
            "database_paths": {
              "type": "STRING"
            },
            "db_tool": {
              "type": "STRING"
            },
            "disk_image": {
              "type": "STRING"
            },
            "machine_type": {
              "type": "STRING"
            },
            "project": {
              "type": "STRING"
            },
            "region": {
              "type": "STRING"
            },
            "runner_image": {
              "type": "STRING"
            }
          }
        },
        "outputDefinitions": {
          "artifacts": {
            "logging": {
              "artifactType": {
                "schemaTitle": "system.Artifact",
                "schemaVersion": "0.0.1"
              }
            },
            "output_data": {
              "artifactType": {
                "schemaTitle": "system.Dataset",
                "schemaVersion": "0.0.1"
              }
            }
          }
        }
      },
      "comp-importer": {
        "executorLabel": "exec-importer",
        "inputDefinitions": {
          "parameters": {
            "uri": {
              "type": "STRING"
            }
          }
        },
        "outputDefinitions": {
          "artifacts": {
            "artifact": {
              "artifactType": {
                "schemaTitle": "system.Dataset",
                "schemaVersion": "0.0.1"
              }
            }
          }
        }
      }
    },
    "deploymentSpec": {
      "executors": {
        "exec-db-search": {
          "container": {
            "args": [
              "--project",
              "{{$.inputs.parameters['project']}}",
              "--regions",
              "{{$.inputs.parameters['region']}}",
              "--machine-type",
              "{{$.inputs.parameters['machine_type']}}",
              "--boot-disk-size",
              "{{$.inputs.parameters['boot_disk_size']}}",
              "--logging",
              "{{$.outputs.artifacts['logging'].uri}}",
              "--mount",
              "DATABASES_ROOT={{$.inputs.parameters['disk_image']}}",
              "--input",
              "INPUT_PATH={{$.inputs.artifacts['input_data'].uri}}",
              "--output",
              "OUTPUT_PATH={{$.outputs.artifacts['output_data'].uri}}",
              "--executor_input",
              "{{$}}"
            ],
            "image": "gcr.io/jk-mlops-dev/alphafold-components"
          }
        },
        "exec-db-search-2": {
          "container": {
            "args": [
              "--project",
              "{{$.inputs.parameters['project']}}",
              "--regions",
              "{{$.inputs.parameters['region']}}",
              "--machine-type",
              "{{$.inputs.parameters['machine_type']}}",
              "--boot-disk-size",
              "{{$.inputs.parameters['boot_disk_size']}}",
              "--logging",
              "{{$.outputs.artifacts['logging'].uri}}",
              "--mount",
              "DATABASES_ROOT={{$.inputs.parameters['disk_image']}}",
              "--input",
              "INPUT_PATH={{$.inputs.artifacts['input_data'].uri}}",
              "--output",
              "OUTPUT_PATH={{$.outputs.artifacts['output_data'].uri}}",
              "--executor_input",
              "{{$}}"
            ],
            "image": "gcr.io/jk-mlops-dev/alphafold-components"
          }
        },
        "exec-db-search-3": {
          "container": {
            "args": [
              "--project",
              "{{$.inputs.parameters['project']}}",
              "--regions",
              "{{$.inputs.parameters['region']}}",
              "--machine-type",
              "{{$.inputs.parameters['machine_type']}}",
              "--boot-disk-size",
              "{{$.inputs.parameters['boot_disk_size']}}",
              "--logging",
              "{{$.outputs.artifacts['logging'].uri}}",
              "--mount",
              "DATABASES_ROOT={{$.inputs.parameters['disk_image']}}",
              "--input",
              "INPUT_PATH={{$.inputs.artifacts['input_data'].uri}}",
              "--output",
              "OUTPUT_PATH={{$.outputs.artifacts['output_data'].uri}}",
              "--executor_input",
              "{{$}}"
            ],
            "image": "gcr.io/jk-mlops-dev/alphafold-components"
          }
        },
        "exec-db-search-4": {
          "container": {
            "args": [
              "--project",
              "{{$.inputs.parameters['project']}}",
              "--regions",
              "{{$.inputs.parameters['region']}}",
              "--machine-type",
              "{{$.inputs.parameters['machine_type']}}",
              "--boot-disk-size",
              "{{$.inputs.parameters['boot_disk_size']}}",
              "--logging",
              "{{$.outputs.artifacts['logging'].uri}}",
              "--mount",
              "DATABASES_ROOT={{$.inputs.parameters['disk_image']}}",
              "--input",
              "INPUT_PATH={{$.inputs.artifacts['input_data'].uri}}",
              "--output",
              "OUTPUT_PATH={{$.outputs.artifacts['output_data'].uri}}",
              "--executor_input",
              "{{$}}"
            ],
            "image": "gcr.io/jk-mlops-dev/alphafold-components"
          }
        },
        "exec-importer": {
          "importer": {
            "artifactUri": {
              "runtimeParameter": "uri"
            },
            "typeSchema": {
              "schemaTitle": "system.Dataset",
              "schemaVersion": "0.0.1"
            }
          }
        }
      }
    },
    "pipelineInfo": {
      "name": "alphafold-inference"
    },
    "root": {
      "dag": {
        "tasks": {
          "db-search": {
            "cachingOptions": {
              "enableCache": true
            },
            "componentRef": {
              "name": "comp-db-search"
            },
            "dependentTasks": [
              "importer"
            ],
            "inputs": {
              "artifacts": {
                "input_data": {
                  "taskOutputArtifact": {
                    "outputArtifactKey": "artifact",
                    "producerTask": "importer"
                  }
                }
              },
              "parameters": {
                "boot_disk_size": {
                  "runtimeValue": {
                    "constantValue": {
                      "intValue": "100"
                    }
                  }
                },
                "database_paths": {
                  "runtimeValue": {
                    "constantValue": {
                      "stringValue": "uniref90/uniref90.fasta"
                    }
                  }
                },
                "db_tool": {
                  "runtimeValue": {
                    "constantValue": {
                      "stringValue": "jackhmmer"
                    }
                  }
                },
                "disk_image": {
                  "componentInputParameter": "datasets_disk_image"
                },
                "machine_type": {
                  "runtimeValue": {
                    "constantValue": {
                      "stringValue": "n1-standard-8"
                    }
                  }
                },
                "project": {
                  "componentInputParameter": "project"
                },
                "region": {
                  "componentInputParameter": "region"
                },
                "runner_image": {
                  "runtimeValue": {
                    "constantValue": {
                      "stringValue": "gcr.io/jk-mlops-dev/alphafold"
                    }
                  }
                }
              }
            },
            "taskInfo": {
              "name": "Search Uniref"
            }
          },
          "db-search-2": {
            "cachingOptions": {
              "enableCache": true
            },
            "componentRef": {
              "name": "comp-db-search-2"
            },
            "dependentTasks": [
              "importer"
            ],
            "inputs": {
              "artifacts": {
                "input_data": {
                  "taskOutputArtifact": {
                    "outputArtifactKey": "artifact",
                    "producerTask": "importer"
                  }
                }
              },
              "parameters": {
                "boot_disk_size": {
                  "runtimeValue": {
                    "constantValue": {
                      "intValue": "100"
                    }
                  }
                },
                "database_paths": {
                  "runtimeValue": {
                    "constantValue": {
                      "stringValue": "mgnify/mgy_clusters_2018_12.fa"
                    }
                  }
                },
                "db_tool": {
                  "runtimeValue": {
                    "constantValue": {
                      "stringValue": "jackhmmer"
                    }
                  }
                },
                "disk_image": {
                  "componentInputParameter": "datasets_disk_image"
                },
                "machine_type": {
                  "runtimeValue": {
                    "constantValue": {
                      "stringValue": "n1-standard-8"
                    }
                  }
                },
                "project": {
                  "componentInputParameter": "project"
                },
                "region": {
                  "componentInputParameter": "region"
                },
                "runner_image": {
                  "runtimeValue": {
                    "constantValue": {
                      "stringValue": "gcr.io/jk-mlops-dev/alphafold"
                    }
                  }
                }
              }
            },
            "taskInfo": {
              "name": "Search Mgnify"
            }
          },
          "db-search-3": {
            "cachingOptions": {
              "enableCache": true
            },
            "componentRef": {
              "name": "comp-db-search-3"
            },
            "dependentTasks": [
              "importer"
            ],
            "inputs": {
              "artifacts": {
                "input_data": {
                  "taskOutputArtifact": {
                    "outputArtifactKey": "artifact",
                    "producerTask": "importer"
                  }
                }
              },
              "parameters": {
                "boot_disk_size": {
                  "runtimeValue": {
                    "constantValue": {
                      "intValue": "100"
                    }
                  }
                },
                "database_paths": {
                  "runtimeValue": {
                    "constantValue": {
                      "stringValue": "uniclust30/uniclust30_2018_08/uniclust30_2018_08,bfd/bfd_metaclust_clu_complete_id30_c90_final_seq.sorted_opt"
                    }
                  }
                },
                "db_tool": {
                  "runtimeValue": {
                    "constantValue": {
                      "stringValue": "hhblits"
                    }
                  }
                },
                "disk_image": {
                  "componentInputParameter": "datasets_disk_image"
                },
                "machine_type": {
                  "runtimeValue": {
                    "constantValue": {
                      "stringValue": "n1-standard-8"
                    }
                  }
                },
                "project": {
                  "componentInputParameter": "project"
                },
                "region": {
                  "componentInputParameter": "region"
                },
                "runner_image": {
                  "runtimeValue": {
                    "constantValue": {
                      "stringValue": "gcr.io/jk-mlops-dev/alphafold"
                    }
                  }
                }
              }
            },
            "taskInfo": {
              "name": "Search Uniclust and BFD"
            }
          },
          "db-search-4": {
            "cachingOptions": {
              "enableCache": true
            },
            "componentRef": {
              "name": "comp-db-search-4"
            },
            "dependentTasks": [
              "db-search"
            ],
            "inputs": {
              "artifacts": {
                "input_data": {
                  "taskOutputArtifact": {
                    "outputArtifactKey": "output_data",
                    "producerTask": "db-search"
                  }
                }
              },
              "parameters": {
                "boot_disk_size": {
                  "runtimeValue": {
                    "constantValue": {
                      "intValue": "100"
                    }
                  }
                },
                "database_paths": {
                  "runtimeValue": {
                    "constantValue": {
                      "stringValue": "pdb70/pdb70"
                    }
                  }
                },
                "db_tool": {
                  "runtimeValue": {
                    "constantValue": {
                      "stringValue": "hhsearch"
                    }
                  }
                },
                "disk_image": {
                  "componentInputParameter": "datasets_disk_image"
                },
                "machine_type": {
                  "runtimeValue": {
                    "constantValue": {
                      "stringValue": "n1-standard-8"
                    }
                  }
                },
                "project": {
                  "componentInputParameter": "project"
                },
                "region": {
                  "componentInputParameter": "region"
                },
                "runner_image": {
                  "runtimeValue": {
                    "constantValue": {
                      "stringValue": "gcr.io/jk-mlops-dev/alphafold"
                    }
                  }
                }
              }
            },
            "taskInfo": {
              "name": "Search Pdb"
            }
          },
          "importer": {
            "cachingOptions": {
              "enableCache": true
            },
            "componentRef": {
              "name": "comp-importer"
            },
            "inputs": {
              "parameters": {
                "uri": {
                  "componentInputParameter": "fasta_path"
                }
              }
            },
            "taskInfo": {
              "name": "importer"
            }
          }
        }
      },
      "inputDefinitions": {
        "parameters": {
          "datasets_disk_image": {
            "type": "STRING"
          },
          "fasta_path": {
            "type": "STRING"
          },
          "project": {
            "type": "STRING"
          },
          "region": {
            "type": "STRING"
          }
        }
      }
    },
    "schemaVersion": "2.0.0",
    "sdkVersion": "kfp-1.8.11"
  },
  "runtimeConfig": {
    "parameters": {
      "datasets_disk_image": {
        "stringValue": "https://www.googleapis.com/compute/v1/projects/jk-mlops-dev/global/images/jk-alphafold-datasets 3000"
      },
      "project": {
        "stringValue": "jk-mlops-dev"
      },
      "region": {
        "stringValue": "us-central1"
      }
    }
  }
}